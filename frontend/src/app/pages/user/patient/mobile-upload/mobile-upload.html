<div class="mobile-upload-container">
  <div class="top-bar">
    <div class="brand">
      <div class="logo-icon">
        <app-icon name="heart" [size]="24" />
      </div>
      <span class="brand-name">TeleCuidar</span>
    </div>
    <app-theme-toggle />
  </div>

  @if (isSuccess) {
    <div class="success-state">
      <div class="icon-circle">
        <app-icon name="check" [size]="48" />
      </div>
      <h1>Enviado com Sucesso!</h1>
      <p>O arquivo foi enviado para o seu computador. Você pode fechar esta janela.</p>
    </div>
  } @else {
    <div class="upload-form">
      <div class="header">
        <h1>Enviar Anexo</h1>
        <p>Tire uma foto ou escolha um arquivo</p>
      </div>

      <div class="form-group">
        <label for="title">Título do Anexo</label>
        <input type="text" id="title" [(ngModel)]="title" class="form-input" placeholder="Ex: Foto do Exame">
      </div>

      <div class="file-input-wrapper">
        <!-- Hidden Inputs -->
        <input type="file" id="cameraInput" (change)="onTakePhoto($event)" accept="image/*" capture="environment" hidden #cameraInput>
        <input type="file" id="photoInput" (change)="onChoosePhoto($event)" accept="image/*" hidden #photoInput>
        <input type="file" id="fileInput" (change)="onChooseFile($event)" accept="*/*" hidden #fileInput>
        
        @if (selectedFile) {
          <div class="preview-container">
            @if (previewUrl) {
              <img [src]="previewUrl" alt="Preview">
            } @else {
              <div class="file-preview">
                <app-icon name="file" [size]="48" />
                <p>{{ selectedFile.name }}</p>
              </div>
            }
            <div class="change-overlay" (click)="selectedFile = null; previewUrl = null">
              <app-icon name="trash" [size]="24" />
              <span>Remover</span>
            </div>
          </div>
        } @else {
          <div class="buttons-grid">
            <button type="button" class="upload-btn camera" (click)="cameraInput.click()">
              <app-icon name="camera" [size]="32" />
              <span>Tirar Foto</span>
            </button>
            <button type="button" class="upload-btn gallery" (click)="photoInput.click()">
              <app-icon name="smartphone" [size]="32" />
              <span>Galeria</span>
            </button>
            <button type="button" class="upload-btn file" (click)="fileInput.click()">
              <app-icon name="file" [size]="32" />
              <span>Arquivo</span>
            </button>
          </div>
        }
      </div>

      <app-button variant="primary" [fullWidth]="true" (click)="onSubmit()" [disabled]="!title || !selectedFile || isSubmitting">
        @if (isSubmitting) {
          Enviando...
        } @else {
          Enviar para o Computador
        }
      </app-button>
    </div>
  }
</div>
