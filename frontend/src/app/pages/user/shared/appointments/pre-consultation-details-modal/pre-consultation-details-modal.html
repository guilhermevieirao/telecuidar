@if (isOpen) {
  <div class="modal-overlay" (click)="onClose()">
    <div class="modal-container" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Detalhes da Pré-consulta</h2>
        <button class="close-btn" (click)="onClose()">
          <app-icon name="close" [size]="24" />
        </button>
      </div>

      <div class="modal-content" *ngIf="parsedPreConsultation">
        <div class="section">
          <h3>Informações Pessoais</h3>
          <div class="grid">
            <div class="item">
              <span class="label">Nome Completo:</span>
              <span class="value">{{ parsedPreConsultation.personalInfo.fullName }}</span>
            </div>
            <div class="item">
              <span class="label">Data de Nascimento:</span>
              <span class="value">{{ parsedPreConsultation.personalInfo.birthDate | date:'dd/MM/yyyy' }}</span>
            </div>
            <div class="item">
              <span class="label">Peso:</span>
              <span class="value">{{ parsedPreConsultation.personalInfo.weight }} kg</span>
            </div>
            <div class="item">
              <span class="label">Altura:</span>
              <span class="value">{{ parsedPreConsultation.personalInfo.height }} cm</span>
            </div>
          </div>
        </div>

        <div class="section">
          <h3>Histórico Médico</h3>
          <div class="grid">
            <div class="item full-width" *ngIf="parsedPreConsultation.medicalHistory.chronicConditions">
              <span class="label">Doenças Crônicas:</span>
              <span class="value">{{ parsedPreConsultation.medicalHistory.chronicConditions }}</span>
            </div>
            <div class="item full-width" *ngIf="parsedPreConsultation.medicalHistory.medications">
              <span class="label">Medicamentos:</span>
              <span class="value">{{ parsedPreConsultation.medicalHistory.medications }}</span>
            </div>
            <div class="item" *ngIf="parsedPreConsultation.medicalHistory.allergies">
              <span class="label">Alergias:</span>
              <span class="value">{{ parsedPreConsultation.medicalHistory.allergies }}</span>
            </div>
            <div class="item" *ngIf="parsedPreConsultation.medicalHistory.surgeries">
              <span class="label">Cirurgias:</span>
              <span class="value">{{ parsedPreConsultation.medicalHistory.surgeries }}</span>
            </div>
            <div class="item full-width" *ngIf="parsedPreConsultation.medicalHistory.generalObservations">
              <span class="label">Observações:</span>
              <span class="value">{{ parsedPreConsultation.medicalHistory.generalObservations }}</span>
            </div>
          </div>
        </div>

        <div class="section">
          <h3>Hábitos de Vida</h3>
          <div class="grid">
            <div class="item">
              <span class="label">Fumante:</span>
              <span class="value">{{ parsedPreConsultation.lifestyleHabits.smoker | titlecase }}</span>
            </div>
            <div class="item">
              <span class="label">Álcool:</span>
              <span class="value">{{ parsedPreConsultation.lifestyleHabits.alcoholConsumption | titlecase }}</span>
            </div>
            <div class="item">
              <span class="label">Atividade Física:</span>
              <span class="value">{{ parsedPreConsultation.lifestyleHabits.physicalActivity | titlecase }}</span>
            </div>
            <div class="item full-width" *ngIf="parsedPreConsultation.lifestyleHabits.generalObservations">
              <span class="label">Observações:</span>
              <span class="value">{{ parsedPreConsultation.lifestyleHabits.generalObservations }}</span>
            </div>
          </div>
        </div>

        <div class="section">
          <h3>Sinais Vitais</h3>
          <div class="grid">
            <div class="item" *ngIf="parsedPreConsultation.vitalSigns.bloodPressure">
              <span class="label">Pressão Arterial:</span>
              <span class="value">{{ parsedPreConsultation.vitalSigns.bloodPressure }} mmHg</span>
            </div>
            <div class="item" *ngIf="parsedPreConsultation.vitalSigns.heartRate">
              <span class="label">Batimentos:</span>
              <span class="value">{{ parsedPreConsultation.vitalSigns.heartRate }} bpm</span>
            </div>
            <div class="item" *ngIf="parsedPreConsultation.vitalSigns.temperature">
              <span class="label">Temperatura:</span>
              <span class="value">{{ parsedPreConsultation.vitalSigns.temperature }} °C</span>
            </div>
            <div class="item" *ngIf="parsedPreConsultation.vitalSigns.oxygenSaturation">
              <span class="label">Saturação O2:</span>
              <span class="value">{{ parsedPreConsultation.vitalSigns.oxygenSaturation }}%</span>
            </div>
            <div class="item full-width" *ngIf="parsedPreConsultation.vitalSigns.generalObservations">
              <span class="label">Observações:</span>
              <span class="value">{{ parsedPreConsultation.vitalSigns.generalObservations }}</span>
            </div>
          </div>
        </div>

        <div class="section">
          <h3>Sintomas Atuais</h3>
          <div class="grid">
            <div class="item full-width">
              <span class="label">Sintomas Principais:</span>
              <span class="value">{{ parsedPreConsultation.currentSymptoms.mainSymptoms }}</span>
            </div>
            <div class="item">
              <span class="label">Início:</span>
              <span class="value">{{ parsedPreConsultation.currentSymptoms.symptomOnset }}</span>
            </div>
            <div class="item" *ngIf="parsedPreConsultation.currentSymptoms.painIntensity !== null">
              <span class="label">Intensidade da Dor:</span>
              <span class="value">{{ parsedPreConsultation.currentSymptoms.painIntensity }}/10</span>
            </div>
            <div class="item full-width" *ngIf="parsedPreConsultation.currentSymptoms.generalObservations">
              <span class="label">Descrição Detalhada:</span>
              <span class="value">{{ parsedPreConsultation.currentSymptoms.generalObservations }}</span>
            </div>
          </div>
        </div>

        <div class="section" *ngIf="parsedPreConsultation.additionalObservations">
          <h3>Observações Adicionais</h3>
          <p>{{ parsedPreConsultation.additionalObservations }}</p>
        </div>

        <!-- Anexos -->
        <div class="section" *ngIf="parsedPreConsultation.attachments && parsedPreConsultation.attachments.length > 0">
          <h3>Anexos</h3>
          <div class="attachments-grid">
            <div class="attachment-item" *ngFor="let attachment of parsedPreConsultation.attachments" (click)="openAttachment(attachment)">
              <div class="attachment-preview">
                <img *ngIf="attachment.type === 'image'" [src]="attachment.fileUrl" [alt]="attachment.title">
                <div *ngIf="attachment.type !== 'image'" class="file-icon">
                  <app-icon name="file" [size]="32" />
                </div>
              </div>
              <span class="attachment-title">{{ attachment.title }}</span>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <app-button variant="primary" (click)="onClose()">Fechar</app-button>
      </div>
    </div>
  </div>
}

<app-media-preview-modal
  [isOpen]="isPreviewOpen"
  [url]="previewUrl"
  [title]="previewTitle"
  [type]="previewType"
  (close)="closePreview()"
  (download)="downloadAttachment()">
</app-media-preview-modal>
