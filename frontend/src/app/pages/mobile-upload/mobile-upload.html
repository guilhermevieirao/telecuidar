<div class="mobile-upload-container">
  <header class="header">
    <div class="logo">
      <app-icon name="smartphone" [size]="24" />
      <span>TeleCuidar Upload</span>
    </div>
    <app-theme-toggle />
  </header>

  <main class="content">
    <div class="upload-card">
      <!-- Success Message -->
      <div class="status-message success" *ngIf="uploadSuccess">
        <app-icon name="check-circle" [size]="48" />
        <h3>Arquivos enviados com sucesso!</h3>
        <p *ngIf="uploadCount === 1">1 arquivo enviado. Você pode enviar mais ou fechar esta janela.</p>
        <p *ngIf="uploadCount > 1">{{ uploadCount }} arquivos enviados. Você pode enviar mais ou fechar esta janela.</p>
        <app-button (click)="cancelUpload()" variant="primary">Enviar mais arquivos</app-button>
      </div>

      <div class="upload-form" *ngIf="!uploadSuccess">
        <!-- Action Buttons (Always visible to add more files) -->
        <div class="action-buttons">
          <div class="instruction-header">
            <h2>Enviar Anexos</h2>
            <p *ngIf="selectedFiles.length === 0">Selecione um ou mais arquivos</p>
            <p *ngIf="selectedFiles.length > 0">{{ selectedFiles.length }} arquivo(s) selecionado(s)</p>
          </div>

          <div class="action-buttons-row">
            <button class="action-btn compact" (click)="triggerCamera()">
              <div class="icon-circle camera">
                <app-icon name="camera" [size]="24" />
              </div>
              <span>Câmera</span>
            </button>

            <button class="action-btn compact" (click)="triggerGallery()">
              <div class="icon-circle gallery">
                <app-icon name="image" [size]="24" />
              </div>
              <span>Galeria</span>
            </button>

            <button class="action-btn compact" (click)="triggerFiles()">
              <div class="icon-circle files">
                <app-icon name="file" [size]="24" />
              </div>
              <span>Arquivos</span>
            </button>
          </div>
        </div>

        <!-- Selected Files List -->
        <div class="selected-files-list" *ngIf="selectedFiles.length > 0">
          <div class="file-item" *ngFor="let item of selectedFiles; let i = index">
            <div class="file-preview">
              <img *ngIf="item.previewUrl" [src]="item.previewUrl" alt="Preview">
              <app-icon *ngIf="!item.previewUrl" name="file" [size]="24" />
            </div>
            <div class="file-details">
              <input 
                type="text" 
                [(ngModel)]="item.title" 
                class="title-input"
                placeholder="Título do arquivo">
              <span class="file-size">{{ formatBytes(item.file.size) }}</span>
            </div>
            <button class="remove-btn" (click)="removeFile(i)">
              <app-icon name="close" [size]="18" />
            </button>
          </div>
        </div>

        <!-- Send Button -->
        <div class="send-section" *ngIf="selectedFiles.length > 0">
          <app-button [fullWidth]="true" size="lg" (click)="sendAllAttachments()" [disabled]="isUploading">
            <ng-container *ngIf="!isUploading">
              Enviar {{ selectedFiles.length }} arquivo(s)
              <app-icon name="arrow-right" [size]="20" />
            </ng-container>
            <ng-container *ngIf="isUploading">
              Enviando {{ currentUploadIndex }} de {{ selectedFiles.length }}...
            </ng-container>
          </app-button>
          <button class="cancel-link" (click)="cancelUpload()" *ngIf="!isUploading">Cancelar</button>
        </div>
      </div>
    </div>

    <!-- Hidden Inputs (with multiple support) -->
    <input 
      type="file" 
      #cameraInput
      accept="image/*,video/*"
      capture="environment"
      (change)="onFileSelected($event)" 
      hidden>

    <input 
      type="file" 
      #galleryInput
      accept="image/*,video/*"
      (change)="onFileSelected($event)" 
      hidden 
      multiple>

    <input 
      type="file" 
      #fileInput 
      (change)="onFileSelected($event)" 
      hidden 
      multiple>
  </main>
</div>
