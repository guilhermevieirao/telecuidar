@if (isOpen) {
  <div class="modal-backdrop" (click)="onBackdropClick()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal__header">
        <div class="modal__header-content">
          <app-icon name="shield" [size]="24" />
          <h2 class="modal__title">Trocar Senha</h2>
        </div>
        <button
          type="button"
          class="modal__close"
          (click)="onCancel()"
          aria-label="Fechar"
        >
          <app-icon name="close" [size]="24" />
        </button>
      </div>

      <div class="modal__body">
        <p class="modal__description">
          Para sua segurança, digite sua senha atual e escolha uma nova senha forte.
        </p>

        <form class="password-form">
          <div class="password-form__field">
            <label for="current-password" class="password-form__label">
              Senha Atual
            </label>
            <div class="password-form__input-wrapper">
              <input
                id="current-password"
                [type]="showCurrentPassword ? 'text' : 'password'"
                class="password-form__input"
                [(ngModel)]="currentPassword"
                name="currentPassword"
                placeholder="Digite sua senha atual"
                required
                autocomplete="current-password"
              />
              <button
                type="button"
                class="password-form__toggle"
                (click)="toggleCurrentPasswordVisibility()"
                [attr.aria-label]="showCurrentPassword ? 'Ocultar senha' : 'Mostrar senha'"
              >
                <app-icon 
                  [name]="showCurrentPassword ? 'eye-off' : 'eye'" 
                  [size]="20" 
                />
              </button>
            </div>
          </div>

          <div class="password-form__divider"></div>

          <div class="password-form__field">
            <label for="new-password" class="password-form__label">
              Nova Senha
            </label>
            <div class="password-form__input-wrapper">
              <input
                id="new-password"
                [type]="showNewPassword ? 'text' : 'password'"
                class="password-form__input"
                [class.password-form__input--invalid]="newPassword && !isPasswordStrong()"
                [(ngModel)]="newPassword"
                name="newPassword"
                placeholder="Digite sua nova senha"
                required
                autocomplete="new-password"
              />
              <button
                type="button"
                class="password-form__toggle"
                (click)="toggleNewPasswordVisibility()"
                [attr.aria-label]="showNewPassword ? 'Ocultar senha' : 'Mostrar senha'"
              >
                <app-icon 
                  [name]="showNewPassword ? 'eye-off' : 'eye'" 
                  [size]="20" 
                />
              </button>
            </div>
            @if (newPassword) {
              <p 
                class="password-form__hint"
                [class.password-form__hint--success]="isPasswordStrong()"
                [class.password-form__hint--error]="!isPasswordStrong()"
              >
                {{ getPasswordStrengthMessage() }}
              </p>
            }
          </div>

          <div class="password-form__field">
            <label for="confirm-password" class="password-form__label">
              Confirmar Nova Senha
            </label>
            <div class="password-form__input-wrapper">
              <input
                id="confirm-password"
                [type]="showConfirmPassword ? 'text' : 'password'"
                class="password-form__input"
                [class.password-form__input--invalid]="confirmPassword && !passwordsMatch()"
                [(ngModel)]="confirmPassword"
                name="confirmPassword"
                placeholder="Confirme sua nova senha"
                required
                autocomplete="new-password"
              />
              <button
                type="button"
                class="password-form__toggle"
                (click)="toggleConfirmPasswordVisibility()"
                [attr.aria-label]="showConfirmPassword ? 'Ocultar senha' : 'Mostrar senha'"
              >
                <app-icon 
                  [name]="showConfirmPassword ? 'eye-off' : 'eye'" 
                  [size]="20" 
                />
              </button>
            </div>
            @if (confirmPassword && !passwordsMatch()) {
              <p class="password-form__hint password-form__hint--error">
                As senhas não coincidem
              </p>
            }
          </div>

          <div class="password-form__requirements">
            <p class="password-form__requirements-title">Requisitos da senha:</p>
            <ul class="password-form__requirements-list">
              <li>Mínimo de 8 caracteres</li>
              <li>Pelo menos uma letra maiúscula</li>
              <li>Pelo menos uma letra minúscula</li>
              <li>Pelo menos um número</li>
            </ul>
          </div>
        </form>
      </div>

      <div class="modal__footer">
        <app-button
          [variant]="'outline'"
          (click)="onCancel()"
        >
          Cancelar
        </app-button>
        <app-button
          [variant]="'primary'"
          (click)="onSave()"
          [disabled]="!isFormValid()"
        >
          <app-icon name="check" [size]="18" />
          Alterar Senha
        </app-button>
      </div>
    </div>
  </div>
}
